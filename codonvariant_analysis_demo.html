
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Example analysis of barcoded codon variants &#8212; dms_tools2 2.4.5 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="example-analysis-of-barcoded-codon-variants">
<h1>Example analysis of barcoded codon variants<a class="headerlink" href="#example-analysis-of-barcoded-codon-variants" title="Permalink to this headline">¶</a></h1>
<a class="reference download internal" href="codonvariant_analysis_demo_full.ipynb">Download this page as a Jupyter notebook (with outputs)</a><p>Here is an example of analyzing barcoded coding variants of a gene. The
analysis first simulates an “plausible” data set. It then analyzes the
simulated data.</p>
<p>Most of the analysis is done by using a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>
to store and analyze the variants and their sequencing counts.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#setup-for-analysis" id="id7">Setup for analysis</a></li>
<li><a class="reference internal" href="#initialize-a-codonvarianttable" id="id8">Initialize a CodonVariantTable</a><ul>
<li><a class="reference internal" href="#simulate-variants" id="id9">Simulate variants</a></li>
<li><a class="reference internal" href="#analyze-the-codon-variant-table" id="id10">Analyze the codon variant table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simulate-variant-counts" id="id11">Simulate variant counts</a><ul>
<li><a class="reference internal" href="#define-phenotype-function" id="id12">Define phenotype function</a></li>
<li><a class="reference internal" href="#simulate-variant-counts-for-samples" id="id13">Simulate variant counts for samples</a></li>
<li><a class="reference internal" href="#add-counts-to-variant-table" id="id14">Add counts to variant table</a></li>
</ul>
</li>
<li><a class="reference internal" href="#analyze-variant-counts-for-samples" id="id15">Analyze variant counts for samples</a><ul>
<li><a class="reference internal" href="#directly-access-variant-counts" id="id16">Directly access variant counts</a></li>
<li><a class="reference internal" href="#distribution-of-variant-counts" id="id17">Distribution of variant counts</a></li>
<li><a class="reference internal" href="#mutation-frequencies-in-each-sample" id="id18">Mutation frequencies in each sample</a></li>
<li><a class="reference internal" href="#mutation-sampling" id="id19">Mutation sampling</a></li>
</ul>
</li>
<li><a class="reference internal" href="#functional-scores-for-variants" id="id20">Functional scores for variants</a><ul>
<li><a class="reference internal" href="#calculate-functional-scores" id="id21">Calculate functional scores</a></li>
<li><a class="reference internal" href="#distribution-of-functional-scores" id="id22">Distribution of functional scores</a></li>
<li><a class="reference internal" href="#functional-scores-versus-phenotype" id="id23">Functional scores versus phenotype</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="setup-for-analysis">
<h2><a class="toc-backref" href="#id7">Setup for analysis</a><a class="headerlink" href="#setup-for-analysis" title="Permalink to this headline">¶</a></h2>
<p>We import key classes and functions from
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">dms_tools2.codonvarianttable</a>.</p>
<p>We use <a class="reference external" href="https://plotnine.readthedocs.io">plotnine</a> for ggplot2-like
plotting syntax:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">collections</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">random</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">plotnine</span> <span class="k">import</span> <span class="o">*</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dms_tools2</span> <span class="k">import</span> <span class="n">CODONS</span><span class="p">,</span> <span class="n">CODON_TO_AA</span><span class="p">,</span> <span class="n">NTS</span><span class="p">,</span> <span class="n">AAS_WITHSTOP</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">NONSTOP_CODONS</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">CODONS</span> <span class="k">if</span> <span class="n">CODON_TO_AA</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;*&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dms_tools2.codonvarianttable</span> <span class="k">import</span> <span class="n">CodonVariantTable</span><span class="p">,</span> \
<span class="gp">... </span>                                         <span class="n">simulateSampleCounts</span><span class="p">,</span> \
<span class="gp">... </span>                                         <span class="n">PhenotypeSimulator</span><span class="p">,</span> \
<span class="gp">... </span>                                         <span class="n">CBPALETTE</span>
</pre></div>
</div>
<p>Seed random number generators for reproducible output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scipy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Set pandas display options to show large chunks of Data Frames in this
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="initialize-a-codonvarianttable">
<h2><a class="toc-backref" href="#id8">Initialize a CodonVariantTable</a><a class="headerlink" href="#initialize-a-codonvarianttable" title="Permalink to this headline">¶</a></h2>
<p>We create a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>
with simulated data.</p>
<div class="section" id="simulate-variants">
<h3><a class="toc-backref" href="#id9">Simulate variants</a><a class="headerlink" href="#simulate-variants" title="Permalink to this headline">¶</a></h3>
<p>Define a wildtype gene sequence of 60 codons. We will then build a table
of variants of this wildtype sequence.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">genelength</span> <span class="o">=</span> <span class="mi">50</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geneseq</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">NONSTOP_CODONS</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">genelength</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">geneseq</span>
<span class="go">&#39;AGATCCGTGATTCTGCGTGCTTACACCAACTCACGGGTGAAACGTGTAATCTTATGCAACAACGACTTACCTATCCGCAACATCCGGCTGATGATGATCCTACACAACTCCGACGCTAGTTTTTCGACTCCAGTAGGTTTACGCTCAGGA&#39;</span>
</pre></div>
</div>
<p>To initialize a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>,
we need a CSV file giving the barcodes and nucleotide substitutions in
the gene (in 1, 2, … numbering) for each variant. We also need to
specify which library each variant belongs to (we always have at least
one library, but hopefully you have replicate libraries), as well as the
variant call support. The variant call support is confident you are that
the variant is called correctly, and might be the number of PacBio CCSs
that support that variant.</p>
<p>Here we simulate the variants for two libraries. Each library has a
number of variants that is 400-times the codon-length of the gene, and
barcodes are of length 16. We will have a Poisson distributed number of
codon mutations per variant with a mean of 1.3. So the only purpose the
large code block below is to simulate the type of data that we might get
for a real library in order to initialize a plausible
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">libs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lib_1&#39;</span><span class="p">,</span> <span class="s1">&#39;lib_2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variants_per_lib</span> <span class="o">=</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">genelength</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bclen</span> <span class="o">=</span> <span class="mi">16</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">avgcodonmuts</span> <span class="o">=</span> <span class="mf">1.3</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">barcode_variant_dict</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">OrderedDict</span><span class="p">([</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s1">&#39;barcode&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s1">&#39;substitutions&#39;</span><span class="p">,</span> <span class="p">[]),</span>
<span class="gp">... </span>    <span class="p">(</span><span class="s1">&#39;variant_call_support&#39;</span><span class="p">,</span> <span class="p">[])])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libs</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">existing_barcodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">ivariant</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">variants_per_lib</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">barcode</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">NTS</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">bclen</span><span class="p">))</span>
<span class="gp">... </span>        <span class="k">while</span> <span class="n">barcode</span> <span class="ow">in</span> <span class="n">existing_barcodes</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">barcode</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">NTS</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">bclen</span><span class="p">))</span>
<span class="gp">... </span>        <span class="n">existing_barcodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">barcode</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">variant_call_support</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">substitutions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>        <span class="n">ncodonmuts</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">avgcodonmuts</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">for</span> <span class="n">icodon</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">genelength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ncodonmuts</span><span class="p">):</span>
<span class="gp">... </span>            <span class="n">wtcodon</span> <span class="o">=</span> <span class="n">geneseq</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">icodon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">icodon</span><span class="p">]</span>
<span class="gp">... </span>            <span class="n">mutcodon</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">CODONS</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">wtcodon</span><span class="p">])</span>
<span class="gp">... </span>            <span class="k">for</span> <span class="n">i_nt</span><span class="p">,</span> <span class="p">(</span><span class="n">wt_nt</span><span class="p">,</span> <span class="n">mut_nt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">wtcodon</span><span class="p">,</span> <span class="n">mutcodon</span><span class="p">)):</span>
<span class="gp">... </span>                <span class="k">if</span> <span class="n">wt_nt</span> <span class="o">!=</span> <span class="n">mut_nt</span><span class="p">:</span>
<span class="gp">... </span>                    <span class="n">igene</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">icodon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i_nt</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># nucleotide in gene</span>
<span class="gp">... </span>                    <span class="n">substitutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;</span><span class="si">{wt_nt}{igene}{mut_nt}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">barcode_variant_dict</span><span class="p">[</span><span class="s1">&#39;library&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">barcode_variant_dict</span><span class="p">[</span><span class="s1">&#39;barcode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">barcode</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">barcode_variant_dict</span><span class="p">[</span><span class="s1">&#39;substitutions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">substitutions</span><span class="p">))</span>
<span class="gp">... </span>        <span class="n">barcode_variant_dict</span><span class="p">[</span><span class="s1">&#39;variant_call_support&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variant_call_support</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">barcode_variants</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">barcode_variant_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>Here are the first and last few lines of the Data Frame with the
simulated variants. As you can see, it gives the nucleotide mutations
(in 1, 2, … numbering) for each barcode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">barcode_variants</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">  library           barcode               substitutions  variant_call_support</span>
<span class="go">0   lib_1  CGTTGGAATCAGGGCC  G19A C20G T21G G149A A150C                     3</span>
<span class="go">1   lib_1  TCGCCTGGGAAAATGC                 T109C C111G                     2</span>
<span class="go">2   lib_1  CCGTATTTGTGGCATG                                                 1</span>
<span class="go">3   lib_1  TCTCAGTCGTGGAAGT                                                 2</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">barcode_variants</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">      library           barcode             substitutions  variant_call_support</span>
<span class="go">39996   lib_2  GGAGGGTAGCCGAGAC  A25G C26T C27G T52A A54C                     2</span>
<span class="go">39997   lib_2  GGAAAGTATGACTACG                 G37C T38G                     1</span>
<span class="go">39998   lib_2  AGTTATCTGGTAAGTA                                               2</span>
<span class="go">39999   lib_2  GACAATGATGAGGTGG            A79T A80G C81A                     2</span>
</pre></div>
</div>
<p>We now write this Data Frame to a CSV file and use it to initialize a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>.
Obviously in a real experiment you would have determined the CSV file
giving your barcode-variant identities experimentally, and would be
passing that experimentally determined data in CSV format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">barcode_variants</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">variants</span> <span class="o">=</span> <span class="n">CodonVariantTable</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">barcode_variant_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="gp">... </span>                <span class="n">geneseq</span><span class="o">=</span><span class="n">geneseq</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>
with the data on our barcodes and variants. We can get basic information
about the wildtype codon and amino-acid identities at each site using
the <cite>sites</cite>, <cite>codons</cite>, and <cite>aas</cite> attributes of the table. For
instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span> <span class="p">:</span> <span class="mi">10</span><span class="p">]</span>
<span class="go">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">variants</span><span class="o">.</span><span class="n">codons</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">variants</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span> <span class="p">:</span> <span class="mi">10</span><span class="p">])</span>
<span class="go">[&#39;AGA&#39;, &#39;TCC&#39;, &#39;GTG&#39;, &#39;ATT&#39;, &#39;CTG&#39;, &#39;CGT&#39;, &#39;GCT&#39;, &#39;TAC&#39;, &#39;ACC&#39;, &#39;AAC&#39;]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">variants</span><span class="o">.</span><span class="n">aas</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">variants</span><span class="o">.</span><span class="n">sites</span><span class="p">[</span> <span class="p">:</span> <span class="mi">10</span><span class="p">])</span>
<span class="go">[&#39;R&#39;, &#39;S&#39;, &#39;V&#39;, &#39;I&#39;, &#39;L&#39;, &#39;R&#39;, &#39;A&#39;, &#39;Y&#39;, &#39;T&#39;, &#39;N&#39;]</span>
</pre></div>
</div>
<p>We can get a list of the libraries for which we have barcodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">libraries</span>
<span class="go">[&#39;lib_1&#39;, &#39;lib_2&#39;]</span>
</pre></div>
</div>
<p>We can also get a Data Frame that includes the information we passed
about the variants along with additional columns containing amino-acid
mutations and mutation counts via the <cite>barcode_variant_df</cite> attribute
of our
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">barcode_variant_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">  library           barcode  variant_call_support                 codon_substitutions    aa_substitutions  n_codon_substitutions  n_aa_substitutions</span>
<span class="go">0   lib_1  AAAAAACGTTTTGTCC                     1                             AGA1TGT                 R1C                      1                   1</span>
<span class="go">1   lib_1  AAAAAAGACGACCCAT                     1                   AAC20TAA CGC26CAG           N20* R26Q                      2                   2</span>
<span class="go">2   lib_1  AAAAAAGCTTCATTTG                     3  AGA1CCG CGC26TGG AAC36TTA GGA50ATC  R1P R26W N36L G50I                      4                   4</span>
<span class="go">3   lib_1  AAAAAAGGTGACAATA                     3                            GTA16TCA                V16S                      1                   1</span>
</pre></div>
</div>
</div>
<div class="section" id="analyze-the-codon-variant-table">
<h3><a class="toc-backref" href="#id10">Analyze the codon variant table</a><a class="headerlink" href="#analyze-the-codon-variant-table" title="Permalink to this headline">¶</a></h3>
<p>The
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>
has a large number of methods to get or plot information about the
variants (look at the
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">documentation</a>
for details on these methods).</p>
<p>Eventually, we will add the counts of different variants for specific
samples. But for now, we haven’t added any samples. However, we can use
the analysis methods of our
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>
to get information about the variant composition itself by calling them
with <cite>samples=None</cite>. When we do that, we simply get</p>
<p>Get the number of variants in each library using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.n_variants_df">CodonVariantTable.n_variants_df</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">n_variants_df</span><span class="p">(</span><span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="go">         library             sample  count</span>
<span class="go">0          lib_1  barcoded variants  20000</span>
<span class="go">1          lib_2  barcoded variants  20000</span>
<span class="go">2  all libraries  barcoded variants  40000</span>
</pre></div>
</div>
<p>Get the set of valid barcodes for each library using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.valid_barcodes">CodonVariantTable.valid_barcodes</a>.
Here we just show the first few valid barcodes for the first library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="n">variants</span><span class="o">.</span><span class="n">valid_barcodes</span><span class="p">(</span><span class="s1">&#39;lib_1&#39;</span><span class="p">))[</span> <span class="p">:</span> <span class="mi">3</span><span class="p">]</span>
<span class="go">[&#39;AAAAAACGTTTTGTCC&#39;, &#39;AAAAAAGACGACCCAT&#39;, &#39;AAAAAAGCTTCATTTG&#39;]</span>
</pre></div>
</div>
<p>Plots the number of mutations per variant using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.plotNumMutsHistogram">CodonVariantTable.plotNumMutsHistogram</a>.
Here we do that for amino-acid mutations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotNumMutsHistogram</span><span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-16.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-16.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-16.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-16.png" src="_images/codonvariant_analysis_demo-16.png" />
</div>
<p>We can make a similar plot for codon mutations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotNumMutsHistogram</span><span class="p">(</span><span class="s1">&#39;codon&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-17.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-17.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-17.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-17.png" src="_images/codonvariant_analysis_demo-17.png" />
</div>
<p>Examine the average frequency of codon mutations of each type per
variant using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.plotNumCodonMutsByType">CodonVariantTable.plotNumCodonMutsByType</a>.
First, we just do that for single-codon variants and wildtype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotNumCodonMutsByType</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-18.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-18.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-18.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-18.png" src="_images/codonvariant_analysis_demo-18.png" />
</div>
<p>Now for variants with any number of mutations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotNumCodonMutsByType</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-19.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-19.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-19.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-19.png" src="_images/codonvariant_analysis_demo-19.png" />
</div>
<p>Examine how well mutations are sampled in the library by looking at the
fraction of mutations seen &lt;= some number of times using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.plotCumulMutCoverage">CodonVariantTable.plotCumulMutCoverage</a>.
Here we do that for codon mutations, looking at just for the
single-codon mutants:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotCumulMutCoverage</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;codon&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-20.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-20.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-20.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-20.png" src="_images/codonvariant_analysis_demo-20.png" />
</div>
<p>We can also get the numerical information plotted above using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.mutCounts">CodonVariantTable.mutCounts</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">mutCounts</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">  library             sample mutation  count  mutation_type  site</span>
<span class="go">0   lib_1  barcoded variants      R1S     24  nonsynonymous     1</span>
<span class="go">1   lib_1  barcoded variants     I28R     23  nonsynonymous    28</span>
<span class="go">2   lib_1  barcoded variants      V3R     23  nonsynonymous     3</span>
<span class="go">3   lib_1  barcoded variants     P24S     22  nonsynonymous    24</span>
</pre></div>
</div>
<p>Here are the frequencies of mutations along the gene in our library
plotted using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.plotMutFreqs">CodonVariantTable.plotMutFreqs</a>,
looking at just single amino-acid variants:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotMutFreqs</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-22.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-22.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-22.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-22.png" src="_images/codonvariant_analysis_demo-22.png" />
</div>
<p>We can also look at comparable information in a heat-map form using
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.plotMutHeatMap">CodonVariantTable.plotMutHeatMap</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotMutHeatmap</span><span class="p">(</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-23.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-23.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-23.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-23.png" src="_images/codonvariant_analysis_demo-23.png" />
</div>
</div>
</div>
<div class="section" id="simulate-variant-counts">
<h2><a class="toc-backref" href="#id11">Simulate variant counts</a><a class="headerlink" href="#simulate-variant-counts" title="Permalink to this headline">¶</a></h2>
<p>An experiment involves looking at how the counts of the different
variants changes under selection. In a <strong>real</strong> experiment, you would
obtain the variant counts by sequencing the barcodes pre- and
post-selection.</p>
<p>However, here we <strong>simulate</strong> an experiment by simulating codon counts
based on a known phenotype for each variant to show demonstrate the
analysis.</p>
<p>We use
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.simulateSampleCounts">simulateSampleCounts</a>
to simulate data for an experiment. This function simulates the counts
of variants pre- and post-selection; the change in variant counts after
selection indicates the effect of a mutation.</p>
<div class="section" id="define-phenotype-function">
<h3><a class="toc-backref" href="#id12">Define phenotype function</a><a class="headerlink" href="#define-phenotype-function" title="Permalink to this headline">¶</a></h3>
<p>First, we define a “phenotype” function. We will do this using a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.phenotypeSimulator">PhenotypeSimulator</a>,
which follow the concepts of <a class="reference external" href="https://doi.org/10.1073/pnas.1804015115">Otwinoski et
al</a> and <a class="reference external" href="https://doi.org/10.1534/genetics.116.195214">Sailer and
Harms</a> to define the
phenotype in two steps: an underlying latent phenotype that mutations
affect additively, and then a non-linear relationship between this
latent phenotype and the observed phenotype.</p>
<p>First, we initialize a
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.phenotypeSimulator">PhenotypeSimulator</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">phenosimulator</span> <span class="o">=</span> <span class="n">PhenotypeSimulator</span><span class="p">(</span><span class="n">geneseq</span><span class="p">)</span>
</pre></div>
</div>
<p>We plot the relationship of the latent and observed phenotypes, with a
dashed vertical line indicating the wildtype phenotype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">phenosimulator</span><span class="o">.</span><span class="n">plotLatentVersusObservedPhenotype</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-25.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-25.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-25.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-25.png" src="_images/codonvariant_analysis_demo-25.png" />
</div>
<p>Next, we plot the latent and observed phenotypes of all single mutants,
with a dashed vertical line indicating the wildtype phenotype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">phenotype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;latent&#39;</span><span class="p">,</span> <span class="s1">&#39;observed&#39;</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="n">p</span> <span class="o">=</span> <span class="n">phenosimulator</span><span class="o">.</span><span class="n">plotMutsHistogram</span><span class="p">(</span><span class="n">phenotype</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure" id="id1">
<img alt="_images/codonvariant_analysis_demo-26_00.png" src="_images/codonvariant_analysis_demo-26_00.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href=".//codonvariant_analysis_demo-26_00.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-26_00.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-26_00.pdf">pdf</a>)</span></p>
</div>
<div class="figure" id="id2">
<img alt="_images/codonvariant_analysis_demo-26_01.png" src="_images/codonvariant_analysis_demo-26_01.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href=".//codonvariant_analysis_demo-26_01.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-26_01.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-26_01.pdf">pdf</a>)</span></p>
</div>
</div>
<div class="section" id="simulate-variant-counts-for-samples">
<h3><a class="toc-backref" href="#id13">Simulate variant counts for samples</a><a class="headerlink" href="#simulate-variant-counts-for-samples" title="Permalink to this headline">¶</a></h3>
<p>Now we use
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.simulateSampleCounts">simulateSampleCounts</a>
to simulate the counts of variants assuming selection on each variant
proportional to its observed phenotype as defined above. This function
allows us to tune various aspects of the simulations to make them
reflect real experiments, such as by tweaking the error-rate in variant
calling, the sequencing depth, the bottlenecks during the experiment,
and non-uniformity in library composition.</p>
<p>We simulate under a range of conditions spanning reasonable values of
the parameters that are likely to affect the outcome of a real
experiment:</p>
<blockquote>
<div><ul class="simple">
<li>The case where the mutations in each variant are called
perfectly with no errors, and where 5% of them contain an erroneously
mis-called codon mutation.</li>
<li>The library is sequenced to low and high
depth, where low depth is an average of 50 counts per variant, and high
depth is an average of 500 counts per variant.</li>
<li>Where there is a low
(small) or big (loose) bottleneck between the pre- and post-selection
steps. These bottlenecks are equal to 5 or 50 times the total number of
variants in each library.</li>
</ul>
</div></blockquote>
<p>For all simulations, we assume variant composition of the library is
reasonably but not completely uniform.</p>
<p>Simulate sample counts under all of these conditions, and put them in a
data frame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">post_to_pre</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dict mapping each post-selection sample to its pre-selection sample</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">counts_df</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of data frames for each selection</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">err_str</span><span class="p">,</span> <span class="n">err</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;err_&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)]:</span>
<span class="gp">...</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">depth_str</span><span class="p">,</span> <span class="n">depth</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;shallow&#39;</span><span class="p">,</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">variants_per_lib</span><span class="p">),</span>
<span class="gp">... </span>                             <span class="p">(</span><span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="mi">500</span> <span class="o">*</span> <span class="n">variants_per_lib</span><span class="p">)]:</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">sample_prefix</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{err_str}{depth_str}</span><span class="s2">_&quot;</span>
<span class="gp">... </span>        <span class="n">pre_sample_name</span> <span class="o">=</span> <span class="n">sample_prefix</span> <span class="o">+</span> <span class="s1">&#39;pre&#39;</span>
<span class="gp">... </span>        <span class="n">post_lowbottle_sample_name</span> <span class="o">=</span> <span class="n">sample_prefix</span> <span class="o">+</span> <span class="s1">&#39;lowbottle&#39;</span>
<span class="gp">... </span>        <span class="n">post_bigbottle_sample_name</span> <span class="o">=</span> <span class="n">sample_prefix</span> <span class="o">+</span> <span class="s1">&#39;bigbottle&#39;</span>
<span class="gp">... </span>        <span class="n">post_to_pre</span><span class="p">[</span><span class="n">post_lowbottle_sample_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_sample_name</span>
<span class="gp">... </span>        <span class="n">post_to_pre</span><span class="p">[</span><span class="n">post_bigbottle_sample_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_sample_name</span>
<span class="gp">...</span>
<span class="gp">... </span>        <span class="n">counts_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">simulateSampleCounts</span><span class="p">(</span>
<span class="gp">... </span>                        <span class="n">variants</span><span class="o">=</span><span class="n">variants</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">phenotype_func</span><span class="o">=</span><span class="n">phenosimulator</span><span class="o">.</span><span class="n">observedPhenotype</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">variant_error_rate</span><span class="o">=</span><span class="n">err</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">pre_sample</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;total_count&#39;</span><span class="p">:</span><span class="n">depth</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="s1">&#39;uniformity&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
<span class="gp">... </span>                        <span class="n">pre_sample_name</span><span class="o">=</span><span class="n">pre_sample_name</span><span class="p">,</span>
<span class="gp">... </span>                        <span class="n">post_samples</span><span class="o">=</span><span class="p">{</span>
<span class="gp">... </span>                            <span class="n">post_bigbottle_sample_name</span><span class="p">:{</span>
<span class="gp">... </span>                                    <span class="s1">&#39;total_count&#39;</span><span class="p">:</span><span class="n">depth</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="s1">&#39;noise&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="s1">&#39;bottleneck&#39;</span><span class="p">:</span><span class="mi">50</span> <span class="o">*</span> <span class="n">variants_per_lib</span><span class="p">},</span>
<span class="gp">... </span>                            <span class="n">post_lowbottle_sample_name</span><span class="p">:{</span>
<span class="gp">... </span>                                    <span class="s1">&#39;total_count&#39;</span><span class="p">:</span><span class="n">depth</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="s1">&#39;noise&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="gp">... </span>                                    <span class="s1">&#39;bottleneck&#39;</span><span class="p">:</span><span class="mi">5</span> <span class="o">*</span> <span class="n">variants_per_lib</span><span class="p">},</span>
<span class="gp">... </span>                            <span class="p">},</span>
<span class="gp">... </span>                        <span class="p">)</span>
<span class="gp">... </span>                 <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># combine all the simulated data frames</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">counts_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">counts_df</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">post_to_pre</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
<span class="gp">... </span>                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;post-selection&#39;</span><span class="p">,</span> <span class="s1">&#39;pre-selection&#39;</span><span class="p">])</span>
<span class="go">          post-selection    pre-selection</span>
<span class="go">0      shallow_lowbottle      shallow_pre</span>
<span class="go">1      shallow_bigbottle      shallow_pre</span>
<span class="go">2         deep_lowbottle         deep_pre</span>
<span class="go">3         deep_bigbottle         deep_pre</span>
<span class="go">4  err_shallow_lowbottle  err_shallow_pre</span>
<span class="go">5  err_shallow_bigbottle  err_shallow_pre</span>
<span class="go">6     err_deep_lowbottle     err_deep_pre</span>
<span class="go">7     err_deep_bigbottle     err_deep_pre</span>
</pre></div>
</div>
<p>Here are the first few lines of the data frame with the simulated
counts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">counts_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="go">  library           barcode       sample  count</span>
<span class="go">0   lib_1  AAAAAACGTTTTGTCC  shallow_pre     52</span>
<span class="go">1   lib_1  AAAAAAGACGACCCAT  shallow_pre     78</span>
<span class="go">2   lib_1  AAAAAAGCTTCATTTG  shallow_pre     40</span>
<span class="go">3   lib_1  AAAAAAGGTGACAATA  shallow_pre     72</span>
<span class="go">4   lib_1  AAAAAATACGGTCAGC  shallow_pre     51</span>
</pre></div>
</div>
</div>
<div class="section" id="add-counts-to-variant-table">
<h3><a class="toc-backref" href="#id14">Add counts to variant table</a><a class="headerlink" href="#add-counts-to-variant-table" title="Permalink to this headline">¶</a></h3>
<p>We now add the simulated counts to the
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>
using its
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.addSampleCounts">addSampleCounts</a>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">counts_df</span><span class="p">[</span><span class="s1">&#39;sample&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="n">libs</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">icounts</span> <span class="o">=</span> <span class="n">counts_df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;sample == @sample &amp; library == @lib&#39;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">variants</span><span class="o">.</span><span class="n">addSampleCounts</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">icounts</span><span class="p">)</span>
</pre></div>
</div>
<p>We use the
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.n_variants_df">CodonVariantTable.n_variants_df</a>
method to confirm that we have the expected number of variant counts for
each sample:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">n_variants_df</span><span class="p">()</span>
<span class="go">          library                 sample     count</span>
<span class="go">0           lib_1            shallow_pre   1000000</span>
<span class="go">1           lib_1      shallow_bigbottle   1000000</span>
<span class="go">2           lib_1      shallow_lowbottle   1000000</span>
<span class="go">3           lib_1               deep_pre  10000000</span>
<span class="go">4           lib_1         deep_bigbottle  10000000</span>
<span class="go">5           lib_1         deep_lowbottle  10000000</span>
<span class="go">6           lib_1        err_shallow_pre   1000000</span>
<span class="go">7           lib_1  err_shallow_bigbottle   1000000</span>
<span class="go">8           lib_1  err_shallow_lowbottle   1000000</span>
<span class="go">9           lib_1           err_deep_pre  10000000</span>
<span class="go">10          lib_1     err_deep_bigbottle  10000000</span>
<span class="go">11          lib_1     err_deep_lowbottle  10000000</span>
<span class="go">12          lib_2            shallow_pre   1000000</span>
<span class="go">13          lib_2      shallow_bigbottle   1000000</span>
<span class="go">14          lib_2      shallow_lowbottle   1000000</span>
<span class="go">15          lib_2               deep_pre  10000000</span>
<span class="go">16          lib_2         deep_bigbottle  10000000</span>
<span class="go">17          lib_2         deep_lowbottle  10000000</span>
<span class="go">18          lib_2        err_shallow_pre   1000000</span>
<span class="go">19          lib_2  err_shallow_bigbottle   1000000</span>
<span class="go">20          lib_2  err_shallow_lowbottle   1000000</span>
<span class="go">21          lib_2           err_deep_pre  10000000</span>
<span class="go">22          lib_2     err_deep_bigbottle  10000000</span>
<span class="go">23          lib_2     err_deep_lowbottle  10000000</span>
<span class="go">24  all libraries            shallow_pre   2000000</span>
<span class="go">25  all libraries      shallow_bigbottle   2000000</span>
<span class="go">26  all libraries      shallow_lowbottle   2000000</span>
<span class="go">27  all libraries               deep_pre  20000000</span>
<span class="go">28  all libraries         deep_bigbottle  20000000</span>
<span class="go">29  all libraries         deep_lowbottle  20000000</span>
<span class="go">30  all libraries        err_shallow_pre   2000000</span>
<span class="go">31  all libraries  err_shallow_bigbottle   2000000</span>
<span class="go">32  all libraries  err_shallow_lowbottle   2000000</span>
<span class="go">33  all libraries           err_deep_pre  20000000</span>
<span class="go">34  all libraries     err_deep_bigbottle  20000000</span>
<span class="go">35  all libraries     err_deep_lowbottle  20000000</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="analyze-variant-counts-for-samples">
<h2><a class="toc-backref" href="#id15">Analyze variant counts for samples</a><a class="headerlink" href="#analyze-variant-counts-for-samples" title="Permalink to this headline">¶</a></h2>
<p>Now we analyze the variant counts for the samples that we have added to
our
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>.</p>
<div class="section" id="directly-access-variant-counts">
<h3><a class="toc-backref" href="#id16">Directly access variant counts</a><a class="headerlink" href="#directly-access-variant-counts" title="Permalink to this headline">¶</a></h3>
<p>The variant counts are in the <cite>variant_count_df</cite> attribute of the
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>.
Here is what the first few lines of that Data Frame look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">variants</span><span class="o">.</span><span class="n">variant_count_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">            barcode  count library       sample  variant_call_support codon_substitutions aa_substitutions  n_codon_substitutions  n_aa_substitutions</span>
<span class="go">0  TTATCAATTGCGGATG    135   lib_1  shallow_pre                     3    GTG3TAC AAA14CTC         V3Y K14L                      2                   2</span>
<span class="go">1  AAGCTAAGCAGATGGC    132   lib_1  shallow_pre                     3   TTA18GAG TCC37GAA        L18E S37E                      2                   2</span>
<span class="go">2  GTGACCCGAACCTCAT    132   lib_1  shallow_pre                     2                                                           0                   0</span>
<span class="go">3  CTGACAGCGCTCTTCT    131   lib_1  shallow_pre                     1                                                           0                   0</span>
</pre></div>
</div>
</div>
<div class="section" id="distribution-of-variant-counts">
<h3><a class="toc-backref" href="#id17">Distribution of variant counts</a><a class="headerlink" href="#distribution-of-variant-counts" title="Permalink to this headline">¶</a></h3>
<p>We plot the number of counts for each variant in each sample. The
horizontal line shows the total number of variants. The plot shows that
all variants are well-sampled in the pre-selection libraries, but that
post-selection some variants are not sampled or sampled very little.
This is as expected since selection will decrease and increase the
frequency of variants.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotCumulVariantCounts</span><span class="p">(</span><span class="n">heightscale</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">widthscale</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-32.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-32.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-32.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-32.png" src="_images/codonvariant_analysis_demo-32.png" />
</div>
</div>
<div class="section" id="mutation-frequencies-in-each-sample">
<h3><a class="toc-backref" href="#id18">Mutation frequencies in each sample</a><a class="headerlink" href="#mutation-frequencies-in-each-sample" title="Permalink to this headline">¶</a></h3>
<p>We look at the counts of each variant as a function of the number of
amino-acid mutations. We do this separately for the samples with
“shallow” and “deep” sequencing, since these have vastly different
number of counts and so look better with separate y-axes. The plots
below show that selection enriches for variants with fewer mutations,
which is as expected since many mutations are deleterious:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;shallow&#39;</span><span class="p">,</span> <span class="s1">&#39;deep&#39;</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">variants</span><span class="o">.</span><span class="n">samples</span><span class="p">(</span><span class="n">libs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotNumMutsHistogram</span><span class="p">(</span><span class="n">mut_type</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">heightscale</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure" id="id3">
<img alt="_images/codonvariant_analysis_demo-33_00.png" src="_images/codonvariant_analysis_demo-33_00.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href=".//codonvariant_analysis_demo-33_00.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-33_00.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-33_00.pdf">pdf</a>)</span></p>
</div>
<div class="figure" id="id4">
<img alt="_images/codonvariant_analysis_demo-33_01.png" src="_images/codonvariant_analysis_demo-33_01.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href=".//codonvariant_analysis_demo-33_01.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-33_01.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-33_01.pdf">pdf</a>)</span></p>
</div>
<p>Next we plot the average number of codon mutations of each type
(nonsynonymous, synonymous, and stop). We do this for <em>all</em> variants (as
opposed to just single mutants). We see that as expected, there is
strong selection against stop codons, and some selection against
nonsynonymous ones:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotNumCodonMutsByType</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">heightscale</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-34.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-34.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-34.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-34.png" src="_images/codonvariant_analysis_demo-34.png" />
</div>
<p>Here are the mutation frequencies as a function of primary sequence.
This plot is for all variants, showing codon mutations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotMutFreqs</span><span class="p">(</span><span class="n">variant_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">mut_type</span><span class="o">=</span><span class="s1">&#39;codon&#39;</span><span class="p">,</span> <span class="n">heightscale</span><span class="o">=</span><span class="mf">1.9</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-35.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-35.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-35.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-35.png" src="_images/codonvariant_analysis_demo-35.png" />
</div>
</div>
<div class="section" id="mutation-sampling">
<h3><a class="toc-backref" href="#id19">Mutation sampling</a><a class="headerlink" href="#mutation-sampling" title="Permalink to this headline">¶</a></h3>
<p>We look at how thoroughly the different possible mutations are sampled
in our libraries by plotting the fraction of mutations found &lt;= an
indicated number of times. We can do this separately for single-mutants
only or for all variants, and for codon or amino-acid mutations. Here we
do it all variants, showing codon mutations. We make the plot separately
for the shallow and deep sequencing samples. As the plot below shows,
sampling of stop and to a lesser degree nonsynonymous mutations drops
strongly after selection, as expected since many of these are
deleterious:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;shallow&#39;</span><span class="p">,</span> <span class="s1">&#39;deep&#39;</span><span class="p">]:</span>
<span class="gp">... </span>    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">variants</span><span class="o">.</span><span class="n">samples</span><span class="p">(</span><span class="n">libs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">p</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">plotCumulMutCoverage</span><span class="p">(</span><span class="n">variant_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">mut_type</span><span class="o">=</span><span class="s1">&#39;codon&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                      <span class="n">samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span> <span class="n">heightscale</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure" id="id5">
<img alt="_images/codonvariant_analysis_demo-36_00.png" src="_images/codonvariant_analysis_demo-36_00.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href=".//codonvariant_analysis_demo-36_00.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-36_00.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-36_00.pdf">pdf</a>)</span></p>
</div>
<div class="figure" id="id6">
<img alt="_images/codonvariant_analysis_demo-36_01.png" src="_images/codonvariant_analysis_demo-36_01.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href=".//codonvariant_analysis_demo-36_01.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-36_01.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-36_01.pdf">pdf</a>)</span></p>
</div>
</div>
</div>
<div class="section" id="functional-scores-for-variants">
<h2><a class="toc-backref" href="#id20">Functional scores for variants</a><a class="headerlink" href="#functional-scores-for-variants" title="Permalink to this headline">¶</a></h2>
<p>We want to estimate a functional score (similar to “fitness” in the
experimental assay) for each variant based on its change in frequency
post-selection relative to its initial pre-selection frequency.</p>
<div class="section" id="calculate-functional-scores">
<h3><a class="toc-backref" href="#id21">Calculate functional scores</a><a class="headerlink" href="#calculate-functional-scores" title="Permalink to this headline">¶</a></h3>
<p>We can calculate functional scores using the
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html#dms_tools2.codonvarianttable.CodonVariantTable.func_scores">func_scores</a>
method of the
<a class="reference external" href="https://jbloomlab.github.io/dms_tools2/dms_tools2.codonvarianttable.html">CodonVariantTable</a>.
The documentation for that method explains exactly how the scores are
calculated.</p>
<p>In order to calculate functional scores, we need to pair each
post-selection sample with a pre-selection one. We use the pairing
described above when we simulated the samples, which we re-print here:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">post_to_pre</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
<span class="gp">... </span>                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;post-selection&#39;</span><span class="p">,</span> <span class="s1">&#39;pre-selection&#39;</span><span class="p">])</span>
<span class="go">          post-selection    pre-selection</span>
<span class="go">0      shallow_lowbottle      shallow_pre</span>
<span class="go">1      shallow_bigbottle      shallow_pre</span>
<span class="go">2         deep_lowbottle         deep_pre</span>
<span class="go">3         deep_bigbottle         deep_pre</span>
<span class="go">4  err_shallow_lowbottle  err_shallow_pre</span>
<span class="go">5  err_shallow_bigbottle  err_shallow_pre</span>
<span class="go">6     err_deep_lowbottle     err_deep_pre</span>
<span class="go">7     err_deep_bigbottle     err_deep_pre</span>
</pre></div>
</div>
<p>Now we calculate the functional scores for each barcoded variant:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">func_scores</span><span class="p">(</span><span class="n">post_to_pre</span><span class="p">)</span>
</pre></div>
</div>
<p>We can see that the resulting data frame has a functional score (and its
variance) for each barcoded variant:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">  library   pre_sample        post_sample           barcode  func_score  func_score_var  pre_count  post_count  pre_count_wt  post_count_wt  pseudocount                 codon_substitutions  n_codon_substitutions    aa_substitutions  n_aa_substitutions</span>
<span class="go">0   lib_1  shallow_pre  shallow_bigbottle  AAAAAACGTTTTGTCC   -0.038984        0.063444         52          87        273069         467581          0.5                             AGA1TGT                      1                 R1C                   1</span>
<span class="go">1   lib_1  shallow_pre  shallow_bigbottle  AAAAAAGACGACCCAT   -8.070570        4.189264         78           0        273069         467581          0.5                   AAC20TAA CGC26CAG                      2           N20* R26Q                   2</span>
<span class="go">2   lib_1  shallow_pre  shallow_bigbottle  AAAAAAGCTTCATTTG   -7.115800        4.214142         40           0        273069         467581          0.5  AGA1CCG CGC26TGG AAC36TTA GGA50ATC                      4  R1P R26W N36L G50I                   4</span>
<span class="go">3   lib_1  shallow_pre  shallow_bigbottle  AAAAAAGGTGACAATA   -0.795987        0.057831         72          71        273069         467581          0.5                            GTA16TCA                      1                V16S                   1</span>
</pre></div>
</div>
<p>We can also calculate functional scores at the level of amino-acid or
codon substitutions rather than at the level of variants. The difference
is that this calculation groups all variants with a given set of
substitutions before calculating the functional score.</p>
<p>Here are are scores grouping by amino-acid substitutions. Note that
when aggregating at the level of amino-acid substitutions, it makes more
sense to calculate the functional scores relative to all variants with
wild-type amino acid sequences by using <cite>syn_as_wt</cite> (by default, the
calculation is relative to variants with wildtype codon sequences)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores_aa</span> <span class="o">=</span> <span class="n">variants</span><span class="o">.</span><span class="n">func_scores</span><span class="p">(</span><span class="n">post_to_pre</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s1">&#39;aa_substitutions&#39;</span><span class="p">,</span>
<span class="gp">... </span>                                      <span class="n">syn_as_wt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores_aa</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">  library   pre_sample        post_sample aa_substitutions  func_score  func_score_var  pre_count  post_count  pre_count_wt  post_count_wt  pseudocount  n_aa_substitutions</span>
<span class="go">0   lib_1  shallow_pre  shallow_bigbottle                     0.000000        0.000023     289622      495885        289622         495885          0.5                   0</span>
<span class="go">1   lib_1  shallow_pre  shallow_bigbottle             A39*   -7.677562        0.599662        418           3        289622         495885          0.5                   1</span>
<span class="go">2   lib_1  shallow_pre  shallow_bigbottle        A39* F41H   -7.596012        4.199588         56           0        289622         495885          0.5                   2</span>
<span class="go">3   lib_1  shallow_pre  shallow_bigbottle        A39* G50S   -7.718348        4.196593         61           0        289622         495885          0.5                   2</span>
</pre></div>
</div>
<p>Since all libraries have the same samples, we can also calculate functional
scores aggregating across libraries using the <cite>combine_libs</cite> option,
although we don’t do that here.</p>
</div>
<div class="section" id="distribution-of-functional-scores">
<h3><a class="toc-backref" href="#id22">Distribution of functional scores</a><a class="headerlink" href="#distribution-of-functional-scores" title="Permalink to this headline">¶</a></h3>
<p>We can plot the distribution of the functional scores (here taking the
scores at the level of barcoded variants).</p>
<p>Such plots are most informative if we additionally classify variants
by the “types” of mutations they have. Below we define a function to put
the variants in some reasonable classifications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">classifyVariant</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">max_aa</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_codon_substitutions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;wildtype&#39;</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_aa_substitutions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;synonymous&#39;</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;aa_substitutions&#39;</span><span class="p">]:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="s1">&#39;stop&#39;</span>
<span class="gp">... </span>    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n_aa_substitutions&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_aa</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;</span><span class="si">{row[&#39;n_aa_substitutions&#39;]}</span><span class="s2"> nonsynonymous&quot;</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">f</span><span class="s2">&quot;&gt;=</span><span class="si">{max_aa}</span><span class="s2"> nonsynonymous&quot;</span>
</pre></div>
</div>
<p>We then apply this function to our data frame to add a column with our
variant classification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>        <span class="n">func_scores</span>
<span class="gp">... </span>        <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">variant_class</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">classifyVariant</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">... </span>        <span class="p">)</span>
</pre></div>
</div>
<p>Now we plot the distributions of scores, coloring by our variant
classification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">ggplot</span><span class="p">(</span><span class="n">func_scores</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s1">&#39;variant_class&#39;</span><span class="p">,</span> <span class="s1">&#39;func_score&#39;</span><span class="p">))</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">geom_violin</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s1">&#39;variant_class&#39;</span><span class="p">))</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">ylab</span><span class="p">(</span><span class="s1">&#39;functional score&#39;</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">xlab</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">facet_grid</span><span class="p">(</span><span class="s1">&#39;post_sample ~ library&#39;</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
<span class="gp">... </span>          <span class="n">axis_text_x</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">angle</span><span class="o">=</span><span class="mi">90</span><span class="p">))</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">CBPALETTE</span><span class="p">[</span><span class="mi">1</span> <span class="p">:],</span> <span class="n">guide</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-43.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-43.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-43.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-43.png" src="_images/codonvariant_analysis_demo-43.png" />
</div>
<p>We see the expected behavior: stop codon variants have low scores,
nonsynonymous variants have a spread of scores, and wildtype /
synonymous variants have scores around zero. Note, however, that when
there are low bottlenecks or sequencing errors then sometimes even
wildtype / synonymous variants end up with low scores due to the errors
or bottlenecking noise.</p>
</div>
<div class="section" id="functional-scores-versus-phenotype">
<h3><a class="toc-backref" href="#id23">Functional scores versus phenotype</a><a class="headerlink" href="#functional-scores-versus-phenotype" title="Permalink to this headline">¶</a></h3>
<p>Since we simulated the data, we know the <em>true</em> observed phenotype for
each variant. We can therefore correlate the true phenotype with the
observed functional score. Note that given how we defined things above,
we expect the <span class="math notranslate nohighlight">\(\log_2\)</span> of the true phenotype to equal the observed
functional score.</p>
<p>We add the true phenotypes to our data frame of functional scores:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">func_scores</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">observed_phenotype</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">phenosimulator</span><span class="o">.</span><span class="n">observedPhenotype</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">latent_phenotype</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">phenosimulator</span><span class="o">.</span><span class="n">latentPhenotype</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">log_observed_phenotype</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
<span class="gp">... </span>                <span class="n">x</span><span class="o">.</span><span class="n">observed_phenotype</span><span class="p">)</span> <span class="o">/</span> <span class="n">scipy</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>            <span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
</pre></div>
</div>
<p>For highly deleterious mutations at some point it becomes irrelevant to
estimate the exact score as long as we know that it’s very low. In fact,
we don’t expect to be able to accurately estimate the score for highly
impaired variants with very low scores.</p>
<p>So we also calculate a “clipped” score where we simply assign all
functional scores and log observed phenotypes less than -8 to a value of
-8. The reason is that the simulated experiments don’t appear to
estimate values much lower than -8:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">score_clip</span> <span class="o">=</span> <span class="o">-</span><span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func_scores</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">func_scores</span>
<span class="gp">... </span>    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">func_score_clipped</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
<span class="gp">... </span>                    <span class="n">x</span><span class="o">.</span><span class="n">func_score</span><span class="p">,</span> <span class="n">score_clip</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="gp">... </span>            <span class="n">log_observed_phenotype_clipped</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">scipy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
<span class="gp">... </span>                    <span class="n">x</span><span class="o">.</span><span class="n">log_observed_phenotype</span><span class="p">,</span> <span class="n">score_clip</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="gp">... </span>            <span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
</pre></div>
</div>
<p>Now plot the correlation after this clipping at the low end:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">ggplot</span><span class="p">(</span><span class="n">func_scores</span><span class="p">,</span>
<span class="gp">... </span>           <span class="n">aes</span><span class="p">(</span><span class="s1">&#39;log_observed_phenotype_clipped&#39;</span><span class="p">,</span> <span class="s1">&#39;func_score_clipped&#39;</span><span class="p">))</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">facet_grid</span><span class="p">(</span><span class="s1">&#39;post_sample ~ library&#39;</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">theme</span><span class="p">(</span><span class="n">figure_size</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">xlab</span><span class="p">(</span><span class="s1">&#39;true phenotype&#39;</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>    <span class="n">ylab</span><span class="p">(</span><span class="s1">&#39;functional score from experiment&#39;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//codonvariant_analysis_demo-46.png">png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-46.hires.png">hires.png</a>, <a class="reference external" href=".//codonvariant_analysis_demo-46.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/codonvariant_analysis_demo-46.png" src="_images/codonvariant_analysis_demo-46.png" />
</div>
<p>Finally, calculate the Pearson correlation coefficients for the clipped
data. We see below that a small (low) bottleneck, sequencing errors, and
shallower sequencing all decrease the accuracy with which the measured
functional scores correlate with the true phenotype:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">corr</span> <span class="o">=</span> <span class="p">(</span>
<span class="gp">... </span>    <span class="n">func_scores</span>
<span class="gp">... </span>     <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="s1">&#39;post_sample&#39;</span><span class="p">])</span>
<span class="gp">... </span>     <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;func_score_clipped&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span>
<span class="gp">... </span>                      <span class="n">x</span><span class="p">[</span><span class="s1">&#39;log_observed_phenotype_clipped&#39;</span><span class="p">],</span>
<span class="gp">... </span>                      <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">))</span>
<span class="gp">... </span>     <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Pearson correlation&#39;</span><span class="p">)</span>
<span class="gp">... </span>     <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="gp">... </span>     <span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;post_sample&#39;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Pearson correlation&#39;</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;library&#39;</span><span class="p">)</span>
<span class="gp">... </span>     <span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">corr</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">library                lib_1  lib_2</span>
<span class="go">post_sample</span>
<span class="go">shallow_bigbottle      0.982  0.982</span>
<span class="go">shallow_lowbottle      0.931  0.932</span>
<span class="go">deep_bigbottle         0.996  0.996</span>
<span class="go">deep_lowbottle         0.943  0.945</span>
<span class="go">err_shallow_bigbottle  0.962  0.960</span>
<span class="go">err_shallow_lowbottle  0.914  0.910</span>
<span class="go">err_deep_bigbottle     0.976  0.973</span>
<span class="go">err_deep_lowbottle     0.925  0.921</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/BloomLogo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">dms_tools2</h1>
    
  </a>
</p>



<p class="blurb">Tools for analyzing deep mutational scanning data.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jbloomlab&repo=dms_tools2&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/jbloomlab/dms_tools2">
    <img
        alt="https://secure.travis-ci.org/jbloomlab/dms_tools2.svg?branch=master"
        src="https://secure.travis-ci.org/jbloomlab/dms_tools2.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="bcsubamp.html">Barcoded-subamplicon sequencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="prefs.html">Amino-acid preferences</a></li>
<li class="toctree-l1"><a class="reference internal" href="diffsel.html">Differential selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="fracsurvive.html">Fraction surviving</a></li>
<li class="toctree-l1"><a class="reference internal" href="programs.html">Executable programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="citations.html">Citations</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017--2019, the Bloom lab.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/codonvariant_analysis_demo.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/jbloomlab/dms_tools2" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>